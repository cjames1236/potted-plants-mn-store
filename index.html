<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Potted Kitchen — MN-Compliant Hemp Gummies</title>
  <meta name="description" content="Minnesota-compliant hemp-derived Δ9 gummies. Third-party tested by Legend Technical Services. 21+ only, MN shipping only." />
  <!-- Open Graph tags for social media sharing -->
  <meta property="og:title" content="Potted Kitchen — MN-Compliant Hemp Gummies" />
  <meta property="og:description" content="Shop Minnesota-compliant Δ9 THC gummies with ≤5mg per serving. Third-party tested, 21+ only, MN shipping." />
  <meta property="og:image" content="https://raw.githubusercontent.com/cjames1236/potted-plants-mn-store/main/assets/gummies-hero.jpg" />
  <meta property="og:url" content="https://potted-plants-mn-store.vercel.app/" />
  <meta name="keywords" content="Minnesota hemp gummies, Δ9 THC edibles, MN-compliant THC, Potted Kitchen, hemp gummies MN" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- QR code for the COA -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

  <style>
    :root {
      --brand-primary: #166534;
      --brand-primary-dark: #14532D;
      --chip-bg: #ECFDF5;
      --chip-border: #A7F3D0;
      --chip-text: #065F46;
      --hero-from: #F2FBF5;
      --hero-to: #FFF7F0;
    }
    .card { border-radius: 1.25rem; border: 1px solid #e5e7eb; background: #fff }
    .btn { border-radius: 1rem; padding: .6rem 1rem; font-size: .9rem }
    .btn-primary { background: var(--brand-primary); color: #fff }
    .btn-primary:hover { background: var(--brand-primary-dark) }
    .btn-ghost { border: 1px solid #e5e7eb; background: #fff }
    .btn-ghost:hover { background: #f8fafc }
    .chip { font-size: .75rem; border: 1px solid var(--chip-border); border-radius: 9999px; padding: .2rem .5rem; background: var(--chip-bg); color: var(--chip-text) }
    .badge { font-size: .72rem; line-height: 1; padding: .36rem .6rem; border-radius: 999px; background: #ffffffcc; border: 1px solid #e5e7eb; color: #065F46; backdrop-filter: saturate(140%) blur(6px) }
    .no-scroll { overflow: hidden }
    @media (max-width: 640px) {
      .sticky-cta { position: sticky; bottom: 1rem; z-index: 20; }
      #drawer { width: 100vw; max-width: none; }
    }
  </style>
  <!-- Schema markup for product -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Product",
      "name": "Hemp-Derived Δ9 Gummies",
      "description": "Minnesota-compliant hemp gummies with 2.2mg Δ9-THC per gummy, 10 gummies per pack (22mg total). Third-party tested by Legend Technical Services.",
      "brand": { "@type": "Brand", "name": "Potted Kitchen" },
      "offers": {
        "@type": "Offer",
        "price": 24.99,
        "priceCurrency": "USD",
        "availability": "https://schema.org/InStock",
        "url": "https://potted-plants-mn-store.vercel.app/"
      },
      "image": "https://raw.githubusercontent.com/cjames1236/potted-plants-mn-store/main/assets/gummies-hero.jpg"
    }
  </script>
</head>
<body class="min-h-screen bg-neutral-50 text-neutral-900">

  <script>
    /* ---------- CONFIG (edit as needed) ---------- */
    const BRAND = { 
      name: "Potted Kitchen", 
      tagline: "Minnesota-compliant hemp-derived gummies.",
      address: "7105 McCann Ct, Savage, MN 55378",
      email: "Pottedplantsllc@yahoo.com",
      phone: "(612) 670-4094",
      facebookProfile: "https://www.facebook.com/potted.plants.2025"
    };

    const LOGO_URL =
      "https://raw.githubusercontent.com/cjames1236/potted-plants-mn-store/main/snip%20clip%20of%20Potted%20Kitchen%20logo.png";

    const CASH_APP_URL = "https://cash.app/$CurtisGieseke";
    const STRIPE_LINK = "https://buy.stripe.com/cNi6oJdxgawa4mQ4oW4sE00";

    const PRODUCT = {
      id: "mn-thc-gummies-10pk",
      name: "Hemp-Derived Δ9 Gummies",
      desc: "Mixed fruit gummies with 2.2mg Δ9-THC each in child-resistant packaging. 10 gummies per pack (22mg total). MN law compliant (≤5mg/serving, ≤50mg/package). Third-party tested by Legend Technical Services (ISO/IEC 17025).",
      price: 24.99,
      strengthMg: 2.2,
      count: 10,
      batch: "2400824-01",
      imageFallback: "https://placehold.co/1200x800/png?text=Hemp+%CE%949+Gummies",
      coaUrl: "https://1drv.ms/b/c/dc5c1fb05bd2de17/ERfe0luwH1wggNytEAAAAAABBc6xNatFTT68cmIluAhg9A?e=HJCaQQ"
    };

    // Tax rates (Minnesota, effective July 1, 2025)
    const CANNABIS_TAX_RATE = 0.15; // 15% Cannabis Tax
    const STATE_SALES_TAX_RATE = 0.06875; // 6.875% State Sales Tax
    const TOTAL_TAX_RATE = CANNABIS_TAX_RATE + STATE_SALES_TAX_RATE; // 21.875%
    const DISCOUNT_CODE = "POTTED10";
    const DISCOUNT_THRESHOLD = 50;
    const DISCOUNT_RATE = 0.1; // 10% off

    window.currentHeroURL = PRODUCT.imageFallback;
  </script>

  <!-- NAV -->
  <nav class="sticky top-0 z-30 bg-white/90 backdrop-blur border-b">
    <div class="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2 font-semibold text-lg">
        <img id="logo" class="h-9 w-auto object-contain rounded-sm" alt="Potted Kitchen logo" aria-label="Potted Kitchen logo">
        <span class="text-emerald-800" id="brand-name"></span>
      </div>
      <div class="flex items-center gap-4">
        <a href="#home" class="text-sm hover:underline" aria-label="Home">Home</a>
        <a href="#products" class="text-sm hover:underline" aria-label="Shop">Shop</a>
        <a href="#coa" class="text-sm hover:underline" aria-label="Certificate of Analysis">COA</a>
        <a href="#shipping-returns" class="text-sm hover:underline" aria-label="Shipping and Returns">Shipping</a>
        <a href="#about" class="text-sm hover:underline" aria-label="About Us">About</a>
        <a href="#contact" class="text-sm hover:underline" aria-label="Contact">Contact</a>
        <a href="#cart" class="btn btn-ghost" aria-label="Cart">🛒 Cart <span id="cart-count" class="ml-1 text-xs bg-emerald-600 text-white rounded-full px-1.5">0</span></a>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header id="home" class="bg-gradient-to-br" style="background-image:linear-gradient(135deg,var(--hero-from),var(--hero-to))">
    <div class="mx-auto max-w-6xl px-4 py-16 grid md:grid-cols-2 gap-10 items-center">
      <div>
        <h1 class="text-3xl sm:text-4xl font-extrabold leading-tight text-emerald-800">Minnesota-Compliant Hemp Gummies</h1>
        <p class="mt-3 text-neutral-700" id="tagline"></p>
        <div class="mt-6 flex flex-wrap gap-3 text-sm text-neutral-700">
          <span class="chip">≤ 5 mg/serv • ≤ 50 mg/pkg</span>
          <span class="chip">21+ only</span>
          <span class="chip">MN shipping only</span>
          <button id="open-coa-hero" class="btn btn-ghost" aria-label="View Certificate of Analysis">View COA</button>
          <a href="https://1drv.ms/b/c/dc5c1fb05bd2de17/ERfe0luwH1wggNytEAAAAAABBc6xNatFTT68cmIluAhg9A?e=HJCaQQ" target="_blank" rel="noreferrer" class="btn btn-ghost" aria-label="Download Certificate of Analysis">Download COA</a>
        </div>
      </div>
      <div id="hero-img" class="aspect-[4/3] rounded-3xl bg-neutral-100 shadow-inner" aria-label="Product image"></div>
    </div>
  </header>

  <!-- LIMITED-TIME OFFER BANNER -->
  <section id="promo" class="mx-auto max-w-6xl px-4 py-4">
    <div class="card p-4 text-center bg-emerald-100 text-emerald-800">
      <p class="font-semibold">Get 10% off orders over $50 with code <strong>POTTED10</strong>! Limited time offer.</p>
      <a href="#products" class="btn btn-primary mt-3 inline-block" aria-label="Shop now">Shop Now</a>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="mx-auto max-w-6xl px-4 py-8">
    <h2 class="text-2xl font-bold mb-6">About Potted Kitchen</h2>
    <div class="card p-6 text-sm text-neutral-800">
      <p>Potted Kitchen (EIN: 92-2876122) is a small, family-owned Minnesota business registered with the Minnesota Office of Cannabis Management. With a passion for crafting high-quality, hemp-derived Δ9 gummies, we’re dedicated to delivering safe, compliant products that meet the standards of Minnesota Statutes, Chapter 151, Section 72. Our gummies are third-party tested by Legend Technical Services (ISO/IEC 17025) to ensure exceptional quality and transparency for our community.</p>
      <p class="mt-2">Contact us at <a href="mailto:Pottedplantsllc@yahoo.com" class="text-blue-500 hover:underline">Pottedplantsllc@yahoo.com</a>.</p>
    </div>
  </section>

  <!-- POLICY -->
  <section id="policy" class="mx-auto max-w-6xl px-4 py-8">
    <div class="card p-5 md:p-6 flex flex-col md:flex-row items-start md:items-center gap-4">
      <div class="flex-1">
        <h3 class="font-semibold">Shipping, Age & Compliance — Minnesota</h3>
        <ul class="list-disc pl-5 text-sm text-neutral-700 space-y-1">
          <li>21+ only; valid ID required.</li>
          <li>≤ 5 mg THC per serving; ≤ 50 mg per package.</li>
          <li>Child-resistant, tamper-evident, opaque packaging. Keep out of reach of children.</li>
        </ul>
      </div>
      <div class="flex items-center gap-2 w-full md:w-auto">
        <label class="text-sm" for="state">Ship to:</label>
        <select id="state" class="w-full md:w-56 rounded-xl border px-3 py-2 text-sm" aria-label="Select shipping state"></select>
      </div>
      <div id="state-msg" class="text-sm"></div>
    </div>
  </section>

  <!-- SHOP -->
  <section id="products" class="mx-auto max-w-6xl px-4 py-8">
    <h2 class="text-2xl font-bold mb-6">Shop</h2>
    <div class="grid sm:grid-cols-2 gap-6">
      <article class="card p-5">
        <!-- TRUST BLOCK (COA preview + QR) -->
        <figure class="rounded-2xl border bg-white p-4 flex items-center gap-4">
          <div class="flex-1 text-sm">
            <div class="font-semibold flex items-center gap-2">
              ✅ COA Verified
              <span class="inline-block ml-2 px-2 py-1 rounded-full border text-emerald-800">
                <span id="p-strength"></span> mg Δ9 per gummy
              </span>
              <span class="chip ml-2">ISO/IEC 17025</span>
            </div>
            <ul class="mt-2 space-y-1 text-neutral-700">
              <li>Total THC / package: <strong id="p-total"></strong> mg</li>
              <li>Batch / Lot: <span id="p-batch2"></span></li>
              <li>Lab: Legend Technical Services</li>
            </ul>
            <button id="open-coa-card" class="btn btn-ghost mt-3" aria-label="View full Certificate of Analysis">View full COA</button>
          </div>
          <div class="shrink-0 text-center">
            <canvas id="coa-qr" width="128" height="128" class="rounded-md border bg-white"></canvas>
            <div class="text-[10px] text-neutral-500 mt-1">Scan for COA</div>
          </div>
        </figure>

        <h3 class="font-semibold text-lg mt-4" id="p-name"></h3>
        <p class="text-sm text-neutral-600" id="p-desc"></p>
        <ul class="mt-2 text-sm text-neutral-600 list-disc pl-5">
          <li>Locally crafted in Minnesota, OCM-registered</li>
          <li>Delicious mixed fruit flavors for a delightful experience</li>
          <li>Perfect for relaxation, 2.2mg Δ9-THC per gummy</li>
          <li>Third-party tested for safety and potency</li>
        </ul>
        <p class="mt-2 text-sm"><strong id="p-serve"></strong></p>
        <p class="text-sm">Batch #: <span id="p-batch"></span></p>
        <div class="mt-2">
          <label for="flavor" class="text-sm font-semibold">Flavor:</label>
          <select id="flavor" class="w-full rounded-xl border px-3 py-2 text-sm" aria-label="Select gummy flavor">
            <option value="mixed-fruit">Mixed Fruit</option>
            <option value="citrus">Citrus</option>
            <option value="berry">Berry</option>
          </select>
        </div>

        <div class="mt-4 flex flex-col sm:flex-row sm:items-center gap-2 sticky-cta">
          <div class="text-xl font-bold sm:mr-auto" id="p-price"></div>
          <button id="add" class="btn btn-primary w-full sm:w-auto" aria-label="Add to cart">Add to Cart</button>
          <a id="pay-cashapp" target="_blank" rel="noreferrer" class="btn btn-ghost w-full sm:w-auto" style="border-color:var(--brand-primary);color:var(--brand-primary)" aria-label="Pay with Cash App">Pay with Cash App</a>
          <a id="stripe" target="_blank" rel="noreferrer" class="hidden btn btn-ghost w-full sm:w-auto" aria-label="Pay with Stripe">Buy Now (Stripe)</a>
        </div>
        <div class="mt-2">
          <span id="mn-note" class="text-xs text-amber-700 hidden">Select Minnesota to enable checkout.</span>
        </div>
        <div class="mt-2 flex gap-2">
          <span class="chip">Secure Checkout</span>
          <span class="chip">Stripe</span>
          <span class="chip">Cash App</span>
        </div>
      </article>
    </div>
  </section>

  <!-- COA SECTION -->
  <section id="coa" class="mx-auto max-w-6xl px-4 py-8">
    <h2 class="text-2xl font-bold mb-6">Certificate of Analysis</h2>
    <div class="card p-6 text-sm text-neutral-800">
      <p>Our gummies are tested by Legend Technical Services (ISO/IEC 17025) for potency and safety. View or download the COA for batch <span id="coa-batch-section"></span>.</p>
      <div class="mt-4 flex gap-3">
        <button id="open-coa-section" class="btn btn-ghost" aria-label="View Certificate of Analysis">View COA</button>
        <a href="https://1drv.ms/b/c/dc5c1fb05bd2de17/ERfe0luwH1wggNytEAAAAAABBc6xNatFTT68cmIluAhg9A?e=HJCaQQ" target="_blank" rel="noreferrer" class="btn btn-ghost" aria-label="Download Certificate of Analysis">Download COA</a>
      </div>
    </div>
  </section>

  <!-- SHIPPING & RETURNS -->
  <section id="shipping-returns" class="mx-auto max-w-6xl px-4 py-12">
    <h3 class="text-2xl font-bold mb-6">Shipping & Returns</h3>
    <div class="card p-6 space-y-6 text-sm text-neutral-800">
      <div>
        <p class="font-semibold">Where we ship</p>
        <p class="mt-1">We currently ship within <span class="font-medium">Minnesota</span> only. Orders process in 1–2 business days. Adult (21+) signature may be required at delivery.</p>
      </div>
      <div>
        <p class="font-semibold">Return policy (14 days)</p>
        <ul class="list-disc pl-5 mt-1 space-y-1">
          <li>Returns accepted within <span class="font-medium">14 days</span> of delivery for unopened products in original, tamper-evident packaging.</li>
          <li>Opened ingestible products are not returnable unless defective or damaged in transit.</li>
          <li>To start a return, contact us at <a href="mailto:Pottedplantsllc@yahoo.com" class="text-blue-500 hover:underline">Pottedplantsllc@yahoo.com</a> with your order number and photos if applicable.</li>
          <li>Refunds go to the original payment method after inspection. Shipping fees are non-refundable.</li>
        </ul>
      </div>
      <div class="text-xs text-neutral-600">Not legal advice. Policies may update to comply with Minnesota Statutes, Chapter 151, Section 72.</div>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="mx-auto max-w-6xl px-4 py-8">
    <h2 class="text-2xl font-bold mb-6">Contact Us</h2>
    <div class="card p-6 text-sm text-neutral-800">
      <p>Email: <a href="mailto:Pottedplantsllc@yahoo.com" class="text-blue-500 hover:underline">Pottedplantsllc@yahoo.com</a></p>
      <p>Phone: (612) 670-4094</p>
      <p>Address: 7105 McCann Ct, Savage, MN 55378</p>
      <p class="mt-2">Follow us on <a href="https://www.facebook.com/potted.plants.2025" class="text-blue-500 hover:underline" target="_blank" rel="noreferrer">Facebook</a> for updates and promotions!</p>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="border-t bg-white">
    <div class="mx-auto max-w-6xl px-4 py-10 grid md:grid-cols-4 gap-6 text-sm">
      <div>
        <div class="font-semibold flex items-center gap-2">🍳 Potted Kitchen</div>
        <p class="mt-2 text-neutral-600">© <span id="year"></span> Potted Kitchen LLC. All rights reserved.</p>
        <p class="mt-2 text-neutral-600">7105 McCann Ct, Savage, MN 55378</p>
        <p class="mt-1 text-neutral-600"><a href="mailto:Pottedplantsllc@yahoo.com" class="hover:underline">Pottedplantsllc@yahoo.com</a></p>
        <p class="mt-1 text-neutral-600">Follow: <a href="https://www.facebook.com/potted.plants.2025" class="hover:underline" target="_blank" rel="noreferrer">Facebook</a></p>
        <form action="https://your-mailchimp-url" method="post" class="mt-4">
          <label for="email" class="text-sm font-semibold">Join our newsletter</label>
          <div class="flex gap-2">
            <input type="email" name="EMAIL" placeholder="Enter your email" class="w-full rounded-xl border px-3 py-2 text-sm" aria-label="Email for newsletter">
            <button type="submit" class="btn btn-primary" aria-label="Subscribe to newsletter">Subscribe</button>
          </div>
        </form>
      </div>
      <div>
        <p class="font-semibold">Company</p>
        <ul class="mt-2 space-y-1 text-neutral-700">
          <li><a href="#about" class="hover:underline">About Us</a></li>
          <li><a href="#policy" class="hover:underline">Compliance</a></li>
          <li><a href="#shipping-returns" class="hover:underline">Shipping & Returns</a></li>
          <li><a href="#contact" class="hover:underline">Contact</a></li>
        </ul>
      </div>
      <div>
        <p class="font-semibold">Legal</p>
        <ul class="mt-2 space-y-1 text-neutral-700">
          <li><a href="#" class="hover:underline">Terms of Service</a></li>
          <li><a href="#" class="hover:underline">Privacy Policy</a></li>
          <li><a href="#shipping-returns" class="hover:underline">Refund Policy</a></li>
        </ul>
      </div>
      <div class="text-neutral-600">
        <p class="font-semibold">Disclaimers</p>
        <p class="mt-2">These statements have not been evaluated by the FDA and are not intended to diagnose, treat, cure, or prevent any disease. Not for sale to persons under 21. Keep out of reach of children and pets.</p>
        <p class="mt-2 text-xs">Manufactured by Potted Kitchen LLC — Savage, Minnesota. Batch/lot on label. COA available via link. Complies with Minnesota Statutes, Chapter 151, Section 72.</p>
      </div>
    </div>
  </footer>

  <!-- CART -->
  <aside id="drawer" class="fixed inset-y-0 right-0 w-full max-w-md bg-white shadow-2xl translate-x-full transition-transform duration-300 ease-in-out z-40">
    <div class="h-full flex flex-col">
      <div class="p-4 border-b flex items-center justify-between">
        <h4 class="font-semibold">Your Cart</h4>
        <button class="btn btn-ghost" onclick="closeCart()" aria-label="Close cart">✕</button>
      </div>
      <div class="flex-1 overflow-auto p-4 space-y-3" id="cart-items"></div>
      <div class="border-t p-4 space-y-3">
        <div class="flex gap-2">
          <input type="text" id="discount-code" placeholder="Enter discount code" class="w-full rounded-xl border px-3 py-2 text-sm" aria-label="Discount code">
          <button id="apply-discount" class="btn btn-primary" aria-label="Apply discount code">Apply</button>
        </div>
        <p id="discount-error" class="text-xs text-red-600 hidden mt-1">Invalid code or order below $50.</p>
        <div class="flex items-center justify-between text-sm"><span>Subtotal</span><span id="subtotal" class="font-semibold">$0.00</span></div>
        <div class="flex items-center justify-between text-sm"><span>Discount</span><span id="discount" class="font-semibold text-emerald-600">$0.00</span></div>
        <div class="flex items-center justify-between text-sm"><span>Cannabis Tax (15%)</span><span id="cannabis-tax" class="font-semibold">$0.00</span></div>
        <div class="flex items-center justify-between text-sm"><span>State Sales Tax (6.875%)</span><span id="state-tax" class="font-semibold">$0.00</span></div>
        <div class="flex items-center justify-between text-sm font-bold"><span>Total</span><span id="total" class="font-bold">$0.00</span></div>
        <p class="text-xs text-neutral-500">Local taxes may apply based on your shipping location. Shipping calculated at payment.</p>
        <button id="checkout" class="btn btn-primary w-full" aria-label="Proceed to checkout">Pay with Cash App</button>
        <a id="stripe-checkout" href="https://buy.stripe.com/cNi6oJdxgawa4mQ4oW4sE00" target="_blank" rel="noreferrer" class="btn btn-ghost w-full hidden" aria-label="Pay with Stripe">Pay with Stripe</a>
      </div>
    </div>
  </aside>

  <!-- COA MODAL -->
  <div id="coa" class="fixed inset-0 hidden items-center justify-center bg-black/50 p-4 z-50">
    <div class="max-w-lg w-full card p-6">
      <div class="flex items-center justify-between">
        <h4 class="font-semibold">Certificate of Analysis</h4>
        <button class="btn btn-ghost" onclick="toggleCOA(false)" aria-label="Close COA modal">✕</button>
      </div>
      <p class="text-sm mt-2">Batch <span id="coa-batch"></span> tested by Legend Technical Services, St Paul, MN.</p>
      <canvas id="coa-canvas" class="mt-4 w-full" style="max-height: 400px;"></canvas>
      <p id="coa-error" class="text-xs text-red-600 hidden mt-2">Failed to load COA. Please download the PDF.</p>
      <a id="coa-link" class="btn btn-ghost mt-4" target="_blank" rel="noreferrer" aria-label="Open COA PDF">Open COA PDF</a>
    </div>
  </div>

  <!-- AGE GATE -->
  <div id="age" class="fixed inset-0 hidden items-center justify-center bg-black/60 p-4 z-50">
    <div class="max-w-md w-full card p-6 text-center space-y-4">
      <h4 class="text-xl font-bold">Are you 21 or older?</h4>
      <p class="text-sm text-neutral-700">You must be of legal age to enter this site and purchase hemp-derived products in Minnesota.</p>
      <div class="grid grid-cols-2 gap-3">
        <button class="btn btn-ghost" onclick="location.href='https://www.google.com'" aria-label="Exit site">No</button>
        <button class="btn btn-primary" onclick="verifyAge()" aria-label="Confirm 21+">Yes, I am 21+</button>
      </div>
      <p class="text-xs text-neutral-500">By entering, you acknowledge our Terms and Privacy Policy.</p>
    </div>
  </div>

  <!-- MAIN JS (vanilla) -->
  <script>
    const $ = s => document.querySelector(s);
    const fmt = n => n.toLocaleString("en-US", { style: "currency", currency: "USD" });

    // Init text/logo
    $('#logo').src = LOGO_URL;
    $('#brand-name').textContent = BRAND.name;
    $('#tagline').textContent = BRAND.tagline;
    $('#year').textContent = new Date().getFullYear();
    $('#coa-batch-section').textContent = PRODUCT.batch;

    // Product text
    $('#p-name').textContent = PRODUCT.name;
    $('#p-desc').textContent = PRODUCT.desc;
    $('#p-serve').textContent = ${PRODUCT.strengthMg} mg Δ9-THC per gummy × ${PRODUCT.count} gummies = ${PRODUCT.strengthMg * PRODUCT.count} mg total;
    $('#p-batch').textContent = PRODUCT.batch;
    $('#p-price').textContent = fmt(PRODUCT.price);
    $('#p-strength').textContent = PRODUCT.strengthMg.toString();
    $('#p-total').textContent = (PRODUCT.strengthMg * PRODUCT.count).toString();
    $('#p-batch2').textContent = PRODUCT.batch;
    $('#pay-cashapp').href = CASH_APP_URL;

    // Show Stripe buttons if link present
    if (STRIPE_LINK) { 
      const el = $('#stripe'); 
      el.classList.remove('hidden'); 
      el.href = STRIPE_LINK; 
      const elCheckout = $('#stripe-checkout');
      elCheckout.classList.remove('hidden');
      elCheckout.href = STRIPE_LINK;
    }

    $('#coa-batch').textContent = PRODUCT.batch;
    $('#coa-link').href = PRODUCT.coaUrl;
    $('#open-coa-hero').onclick = () => toggleCOA(true);
    $('#open-coa-card').onclick = () => toggleCOA(true);
    $('#open-coa-section').onclick = () => toggleCOA(true);

    // QR code
    if (window.QRCode) {
      QRCode.toCanvas(document.getElementById('coa-qr'), PRODUCT.coaUrl, { width: 128, margin: 1 }, () => {});
    }

    // State select (MN only)
    const states = [["", "Select state…"], ["MN", "Minnesota"], ["AL", "Alabama"], ["AK", "Alaska"], ["AZ", "Arizona"], ["AR", "Arkansas"], ["CA", "California"], ["CO", "Colorado"], ["CT", "Connecticut"], ["DE", "Delaware"], ["FL", "Florida"], ["GA", "Georgia"], ["HI", "Hawaii"], ["ID", "Idaho"], ["IL", "Illinois"], ["IN", "Indiana"], ["IA", "Iowa"], ["KS", "Kansas"], ["KY", "Kentucky"], ["LA", "Louisiana"], ["ME", "Maine"], ["MD", "Maryland"], ["MA", "Massachusetts"], ["MI", "Michigan"], ["MS", "Mississippi"], ["MO", "Missouri"], ["MT", "Montana"], ["NE", "Nebraska"], ["NV", "Nevada"], ["NH", "New Hampshire"], ["NJ", "New Jersey"], ["NM", "New Mexico"], ["NY", "New York"], ["NC", "North Carolina"], ["ND", "North Dakota"], ["OH", "Ohio"], ["OK", "Oklahoma"], ["OR", "Oregon"], ["PA", "Pennsylvania"], ["RI", "Rhode Island"], ["SC", "South Carolina"], ["SD", "South Dakota"], ["TN", "Tennessee"], ["TX", "Texas"], ["UT", "Utah"], ["VT", "Vermont"], ["VA", "Virginia"], ["WA", "Washington"], ["WV", "West Virginia"], ["WI", "Wisconsin"], ["WY", "Wyoming"], ["DC", "District of Columbia"]];
    const sel = $('#state');
    states.forEach(([v, t]) => {
      const o = document.createElement('option');
      o.value = v;
      o.textContent = t;
      sel.appendChild(o);
    });
    let selectedState = "";
    sel.addEventListener('change', () => {
      selectedState = sel.value;
      const msg = $('#state-msg');
      if (!selectedState) {
        msg.textContent = "";
        $('#mn-note').classList.add('hidden');
        return;
      }
      if (selectedState !== "MN") {
        msg.textContent = "⚠️ We currently ship only within Minnesota.";
        msg.className = "text-amber-700 text-sm";
        $('#mn-note').classList.remove('hidden');
      } else {
        msg.textContent = "✔ Minnesota shipping available.";
        msg.className = "text-green-700 text-sm";
        $('#mn-note').classList.add('hidden');
      }
    });

    // Debounce function to prevent rapid cart toggling
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    // Cart with persistence and tax calculation
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    let discountCode = localStorage.getItem('discountCode') || '';
    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
      localStorage.setItem('discountCode', discountCode);
    }
    const openCart = debounce(() => {
      $('#drawer').style.transform = 'translateX(0)';
      document.body.classList.add('no-scroll');
    }, 200);
    const closeCart = debounce(() => {
      $('#drawer').style.transform = 'translateX(100%)';
      document.body.classList.remove('no-scroll');
    }, 200);
    function renderCart() {
      $('#cart-count').textContent = cart.reduce((s, i) => s + i.qty, 0);
      const wrap = $('#cart-items');
      wrap.innerHTML = '';
      let subtotal = 0;
      cart.forEach(item => {
        subtotal += PRODUCT.price * item.qty;
        const row = document.createElement('div');
        row.className = 'card p-3 flex gap-3';
        const imgURL = window.currentHeroURL || PRODUCT.imageFallback;
        row.innerHTML = 
          <div class="h-16 w-16 rounded-lg bg-neutral-100" style="background-image:url('${imgURL}');background-size:cover;background-position:center" aria-label="Product image"></div>
          <div class="flex-1">
            <p class="font-medium">${PRODUCT.name}</p>
            <p class="text-xs text-neutral-600">MN-compliant</p>
            <div class="mt-2 flex items-center gap-2">
              <button class="btn btn-ghost" data-delta="-1" aria-label="Decrease quantity">−</button>
              <span>${item.qty}</span>
              <button class="btn btn-ghost" data-delta="+1" aria-label="Increase quantity">+</button>
            </div>
          </div>
          <div class="text-right">
            <div class="font-semibold">${fmt(PRODUCT.price * item.qty)}</div>
            <button class="text-xs text-neutral-500 hover:underline" data-remove aria-label="Remove item">Remove</button>
          </div>;
        row.querySelector('[data-delta="-1"]').onclick = () => {
          item.qty = Math.max(1, item.qty - 1);
          saveCart();
          renderCart();
        };
        row.querySelector('[data-delta="+1"]').onclick = () => {
          item.qty = item.qty + 1;
          saveCart();
          renderCart();
        };
        row.querySelector('[data-remove]').onclick = () => {
          cart.splice(cart.indexOf(item), 1);
          saveCart();
          renderCart();
        };
        wrap.appendChild(row);
      });
      let discount = 0;
      if (discountCode === DISCOUNT_CODE && subtotal > DISCOUNT_THRESHOLD) {
        discount = subtotal * DISCOUNT_RATE;
      }
      const taxableAmount = subtotal - discount;
      const cannabisTax = taxableAmount * CANNABIS_TAX_RATE;
      const stateTax = taxableAmount * STATE_SALES_TAX_RATE;
      const total = taxableAmount + cannabisTax + stateTax;
      $('#subtotal').textContent = fmt(subtotal);
      $('#discount').textContent = fmt(discount);
      $('#cannabis-tax').textContent = fmt(cannabisTax);
      $('#state-tax').textContent = fmt(stateTax);
      $('#total').textContent = fmt(total);
      $('#discount-code').value = discountCode;
      saveCart();
    }

    // Discount code application
    $('#apply-discount').addEventListener('click', () => {
      discountCode = $('#discount-code').value.trim();
      const error = $('#discount-error');
      if (discountCode === DISCOUNT_CODE && cart.reduce((s, i) => s + PRODUCT.price * i.qty, 0) > DISCOUNT_THRESHOLD) {
        error.classList.add('hidden');
      } else {
        error.classList.remove('hidden');
        discountCode = '';
      }
      saveCart();
      renderCart();
    });

    document.querySelector('a[href="#cart"]').addEventListener('click', (e) => {
      e.preventDefault();
      openCart();
    });
    document.getElementById('add').addEventListener('click', () => {
      const f = cart.find(i => i.id === PRODUCT.id);
      if (f) f.qty += 1;
      else cart.push({ id: PRODUCT.id, qty: 1 });
      saveCart();
      renderCart();
      openCart();
    });

    // Cash App checkout button
    document.getElementById('checkout').addEventListener('click', () => {
      if (!cart.length) return;
      if (sel.value !== "MN") {
        alert("We ship within Minnesota only. Select MN to proceed.");
        return;
      }
      const subtotal = cart.reduce((s, i) => s + PRODUCT.price * i.qty, 0);
      let discount = 0;
      if (discountCode === DISCOUNT_CODE && subtotal > DISCOUNT_THRESHOLD) {
        discount = subtotal * DISCOUNT_RATE;
      }
      const taxableAmount = subtotal - discount;
      const cannabisTax = taxableAmount * CANNABIS_TAX_RATE;
      const stateTax = taxableAmount * STATE_SALES_TAX_RATE;
      const total = taxableAmount + cannabisTax + stateTax;
      const orderId = "PK-" + Math.random().toString(36).slice(2, 8).toUpperCase();
      const flavor = $('#flavor').value;
      const note = Order ${orderId} — ${PRODUCT.name} (${flavor}) x ${cart[0].qty} @ ${fmt(PRODUCT.price)} — Subtotal ${fmt(subtotal)} — Discount ${fmt(discount)} — Cannabis Tax (15%) ${fmt(cannabisTax)} — State Sales Tax (6.875%) ${fmt(stateTax)} — Total ${fmt(total)} — Ship: MN;
      try {
        navigator.clipboard?.writeText(note);
      } catch {}
      alert(Copy this into your Cash App note before paying:\n\n${note});
      window.open(CASH_APP_URL, "_blank");
    });

    // Pay with Cash App button
    document.getElementById('pay-cashapp').addEventListener('click', (e) => {
      e.preventDefault();
      if (!cart.length) {
        cart.push({ id: PRODUCT.id, qty: 1 });
        saveCart();
        renderCart();
      }
      document.getElementById('checkout').click();
    });

    // Stripe button: enforce MN shipping
    document.getElementById('stripe').addEventListener('click', (e) => {
      if (!STRIPE_LINK) return;
      if (sel.value !== "MN") {
        e.preventDefault();
        const msg = document.getElementById("state-msg");
        if (msg) {
          msg.textContent = "Select Minnesota to proceed to checkout.";
          msg.className = "text-amber-700 text-sm";
        }
        openCart();
      }
    });

    // COA modal + Age gate
    async function toggleCOA(show = true) {
      const c = $('#coa');
      c.style.display = show ? 'flex' : 'none';
      if (show) {
        try {
          const script = document.createElement('script');
          script.src = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js';
          script.onload = async () => {
            const pdf = await pdfjsLib.getDocument({ url: PRODUCT.coaUrl }).promise;
            const page = await pdf.getPage(1);
            const viewport = page.getViewport({ scale: 1.8 });
            const canvas = $('#coa-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            await page.render({ canvasContext: ctx, viewport }).promise;
            $('#coa-error').classList.add('hidden');
          };
          script.onerror = () => {
            $('#coa-error').classList.remove('hidden');
          };
          document.head.appendChild(script);
        } catch {
          $('#coa-error').classList.remove('hidden');
        }
      }
    }
    function showAgeGate() {
      const g = $('#age');
      g.style.display = 'flex';
    }
    function verifyAge() {
      localStorage.setItem('hemp_age_verified', JSON.stringify({ verified: true, timestamp: Date.now() }));
      $('#age').style.display = 'none';
    }
    window.verifyAge = verifyAge;
    window.closeCart = closeCart;
    window.toggleCOA = toggleCOA;
    const ageData = JSON.parse(localStorage.getItem('hemp_age_verified') || '{}');
    if (!ageData.verified || (Date.now() - ageData.timestamp > 30 * 24 * 60 * 60 * 1000)) showAgeGate();

    // HERO IMAGE PIPELINE
    (async function setHeroImage() {
      const hero = $('#hero-img');
      function setBG(url) {
        hero.style.backgroundImage = url('${url}');
        hero.style.backgroundSize = 'cover';
        hero.style.backgroundPosition = 'center';
        window.currentHeroURL = url;
      }
      async function tryImg(url) {
        return await new Promise(res => {
          const i = new Image();
          i.onload = () => res(true);
          i.onerror = () => res(false);
          i.src = url + "?v=" + Date.now();
        });
      }
      const candidates = [
        "/assets/gummies-hero.jpg",
        "/assets/gummies-hero.png",
        "https://raw.githubusercontent.com/cjames1236/potted-plants-mn-store/main/assets/gummies-hero.jpg",
        "https://raw.githubusercontent.com/cjames1236/potted-plants-mn-store/main/assets/gummies-hero.png",
      ];
      for (const c of candidates) {
        if (await tryImg(c)) {
          setBG(c);
          return;
        }
      }
      setBG(PRODUCT.imageFallback);
      hero.innerHTML = '<p class="text-sm text-neutral-600 text-center mt-4">Image unavailable</p>';
    })();

    // SMART BUY LINKS
    (function smartBuyLinks() {
      try {
        const qs = new URLSearchParams(location.search);
        const buy = qs.get("buy");
        if (!buy || buy !== PRODUCT.id) return;

        const qty = Math.max(1, parseInt(qs.get("qty") || "1", 10));
        const desiredState = qs.get("state");
        const open = qs.get("open");
        const checkout = qs.get("checkout");

        if (desiredState) {
          sel.value = desiredState;
          sel.dispatchEvent(new Event("change"));
        }

        const existing = cart.find(i => i.id === PRODUCT.id);
        if (existing) existing.qty += qty;
        else cart.push({ id: PRODUCT.id, qty });
        saveCart();
        renderCart();

        if (open === "cart") openCart();

        if (checkout === "cashapp") {
          if (sel.value === "MN") document.getElementById("checkout").click();
          else {
            const msg = document.getElementById("state-msg");
            if (msg) {
              msg.textContent = "Select Minnesota to proceed to checkout.";
              msg.className = "text-amber-700 text-sm";
            }
            openCart();
          }
        }

        if (checkout === "stripe" && STRIPE_LINK) {
          if (sel.value === "MN") window.open(STRIPE_LINK, "_blank");
          else {
            const msg = document.getElementById("state-msg");
            if (msg) {
              msg.textContent = "Select Minnesota to proceed to checkout.";
              msg.className = "text-amber-700 text-sm";
            }
            openCart();
          }
        }
      } catch {/* ignore */}
    })();
  </script>
</body>
</html>
